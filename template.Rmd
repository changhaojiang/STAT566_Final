---
title: "Relationship between lifestyle risk factors and development of prediabetes or diabetes, based on BRFSS 2015 questionnaire"
author: "Tianyang Jiang, Changhao Jiang, Liuye Huang"
abstract: "This paper is about diabetes..."

date: "`r format(Sys.time(), '%B %d, %Y')`"
geometry: margin=1in
output: 
  pdf_document:
    latex_engine: pdflatex
    keep_tex: TRUE
fontsize: 12pt
header-includes:
   - \usepackage{natbib}
   - \bibliographystyle{abbrvnat}
   - \setcitestyle{authoryear, open={((},close={)}}
   - \usepackage{indentfirst}
---

**Keywords:** Diabetes, Lifestyle intervention, Causal inference, R-learner, PC algorithm, Regression adjustment

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r, echo=FALSE, results='hide', message=FALSE, warning=FALSE}
library(knitr)
library(tidyverse)
library(rigr)
library(dplyr)
library(gtsummary)
library(flextable)
library(ggplot2)
library(rlearner)
library(data.table)
library(randomForest)
library(sandwich)
library(car)

data_dir <- "~/Desktop"
data <- fread(file.path(data_dir, "Diabetes.csv"))
balanced_diabetes <- fread(file.path(data_dir,"diabetes_binary_5050split_health_indicators_BRFSS2015.csv"))
```


## Background
With 476.0 million prevalent cases,  1.37 million deaths, and 67.9 million disability-adjusted life-years (DALYs) in 2017, diabetes has become one of the most prominent global concerns in public health. Significant proportions of diabetic burden were considered to be attributed to lifestyle risk factors, such as diet, smoking, drinking, and physical activity (Lin et al. (2021)). This research aims to assess the relationship between modifiable lifestyle risk factors and the risk of developing prediabetes or diabetes, among the U.S. adults.Based on the information mentioned above, we proposed the following research questions: 
What is the relationship between lifestyle factors and the risk of developing prediabetes or diabetes?
Is the relationship still hold after introducing covariates? 
What are the heterogeneous effects of lifestyle factors among subgroups with different age, sex, and income level.


## Data Prepration

### Find Scores with Random Forest
A lifestyle combination score of behavioral factors was constructed using the information of fruits and vegetables consumption, heavy drinking, smoking, and physical activity. It measures the overall healthiness of an individual's lifestyle. This score can be computed by assigning weights to each variable based on their relative importance and then combining the weighted scores. We use the importance function in random forest to compute the importance of the predictor variables in a random forest model. The importance measure is based on the decrease in the node impurity when the variable is used for splitting in the random forest. Then we use the scaled value of the importance to represent the weight. Suppose the importance of each variable is m1, m2, m3, m4and m5 respectively, then the scaled value is $w_i=\frac{m_i}{m_1+m_2+m_3+m_4+m_5}, i=1,2,3,4,5$. Based on the results of the literature review, we find that smoking($v_1$) and heavy drinking($v_2$) will cause diabetes, while more physical exercises($v_3$), fruits($v_4$) and vegetables consumption($v_5$) will reduce the risk of getting diabetes. Thus the combination score is $Score=-w_1v_1-w_2v_2+w_3v_3+w_4v_4+w_5v_5$. We then convert the continuous variable score into a binary variable. This is achieved through grouping by means of the average. Scores that exceed the mean are set to 1, representing a good lifestyle. Those that fall below the mean are assigned 0, indicating a poor lifestyle.

In addition to considering the exposure variables, it's important to take into account other factors that may be linked to diabetes, such as covariates, precision variables, and confounding variables. According to Bird et al. (2015), Nanayakkara et al. (2021) and Lin et al. (2021), certain covariates such as high blood pressure, stroke, heart disease attack and high cholesterol are connected to diabetes, while other covariates such as gender, income, BMI and air pollution have direct effects on diabetes. Therefore, it's crucial to carefully assess and account for all of these variables when studying diabetes.

```{r, echo=FALSE, warning=FALSE}
set.seed(1)
diabetes <- data

fit.forest= randomForest(Diabetes_binary ~ HvyAlcoholConsump + Smoker + 
                           PhysActivity + Fruits + Veggies,
                         data = balanced_diabetes, na.action = na.roughfix)
importance(fit.forest)

w1 = importance(fit.forest)[1] / sum(importance(fit.forest))
w2 = importance(fit.forest)[2] / sum(importance(fit.forest))
w3 = importance(fit.forest)[3] / sum(importance(fit.forest))
w4 = importance(fit.forest)[4] / sum(importance(fit.forest))
w5 = importance(fit.forest)[5] / sum(importance(fit.forest))

diabetes$score = -diabetes$HvyAlcoholConsump * w1 - diabetes$Smoker * w2 + 
  diabetes$PhysActivity * w3 + diabetes$Fruits * w4 + diabetes$Veggies * w5

mean_score <- mean(diabetes$score)

diabetes$scoreCat <- ifelse(diabetes$score > mean_score, 1, 0)
```

### Data Description
Dataset for this study was collected from the The Behavioral Risk Factor Surveillance System (BRFSS) questionnaire in 2015. BRFSS is a nationwide telephone survey system held by the U.S. Center for Disease Control and Prevention (CDC). It collects data on health-related risk behaviors, chronic health conditions, and preventive services usage among the U.S. residents. This system was initiated in 1984 and updated annually, with more than 400,000 adults being interviewed each year. 

The 2015 questionnaire contains three parts, including the core component, optional modules, and state-added questions. The core component consisted of information on demographic characteristics and current health behaviors. The optional modules consisted of topics of health status and behaviors that were not covered in the core set, such as diabetes, immunization, and multiple cancer screening (U.S. CDC). 

Based on the BRFSS 2015 dataset, intotal 253,680 survey responses were included. The outcome of interest was a binary variable. It equal to 1 indicated whether being diagnosed with prediabetes or diabetes, and equal to 0 meat no diabetes or only during pregnancy. 

In total, 25,3680 participants were enrolled in the study. Among them, 35,346 (14%) were diagnosed with prediabetes or diabetes.  Among people who had been diagnosed with prediabetes or diabetes, 48% were male and only 29% had completed college graduate; most of them were elders and with income level between $15,000-$75,000; 75% of them were with high blood pressure and 67% with high cholesterol, and the mean BMI was 32 (SD: 7) kg/m²; 9.2% of them ever had experienced a stroke and 22% with coronary heart disease or myocardial infarction; 96% of them had any kind of health coverage. Among the healthy participants, 43% were male and 44% of them had completed college graduate; most of them were middle-aged adults and 38% of them had the annual income equal or greater than $75,000; only 38% of them had high blood pressure or high cholesterol, respectively, and the mean BMI was 28 (SD: 6) kg/m²; less than 8% of them ever had experienced stroke, coronary heart disease or myocardial infarction; 95% of them had any kind of health coverage. Regarding lifestyles, 55% and 69% of them had the composition score above the mean score of the total population among those who had been diagnosed with prediabetes or diabetes and the healthy, respectively. When specifying different lifestyles, compared with the health participants, more people in the prediabetes/diabetes group ever smoked, were less physically active, and consumed less fruits and vegetables, but less people were heavy drinkers.  More details regarding the distribution of these characteristics were displayed in Table 1. 

Figure 2 a., b., c. revealed that the distribution of participants’ income level, age, and gender varies across different lifestyle combination score categories and diabetes status. This corresponded to our DAG that participants’ income level, age and gender may confound the relationship between lifestyles and the development of prediabetes or diabetes. 

```{r, echo=FALSE, results='hide'}
data$ageCat <- factor(data$Age, levels = 1:13, 
                      labels = c("18-24", "25-29", "30-34", "35-39", "40-44", 
                                 "45-49", "50-54", "55-59", "60-64", "65-69", 
                                 "70-74", "75-79", ">=80") )

data$eduCat <- factor(data$Education, levels = 1:6, labels = 
                        c("Never attended school or only kindergarten", 
                          "Elementary", "Some high school", 
                          "High school graduate", 
                          "Some college or technical school", 
                          "College graduate"))

data$incomeCat <- factor(data$Income, levels = 1:8, 
                         labels = c("< $10,000", "[$10,000, $15,000)", 
                                    "[$15,000, $20,000)", "[$20,000, $25,000)", 
                                    "[$25,000, $35,000)", "[$35,000, $50,000)", 
                                    "[$50,000, $75,000)", ">= $75,000"))

data$diaCat <- factor(data$Diabetes_binary, levels = 0:1, 
                      labels = c("Healthy", "Prediabetes or diabetes"))

data$scoreCat2 = ifelse(data$scoreCat == "> mean score", 1, 0)

data$scoreCat2 <- as.numeric(data$scoreCat2)
data$Diabetes_binary <- as.numeric(data$Diabetes_binary)
data$gender <- factor(data$Sex, levels = 0:1, labels = c("Female", "Male"))

tabl1 <- data %>% select(Diabetes_binary, Sex, ageCat, eduCat, incomeCat, 
                         scoreCat, Smoker,PhysActivity, Fruits, Veggies, 
                         HvyAlcoholConsump, HighBP, HighChol, BMI, Stroke, 
                         HeartDiseaseorAttack, AnyHealthcare) %>%
     tbl_summary(by = Diabetes_binary, label = 
                   list(Diabetes_binary ~ "Diagnosis of diabetes",
     Sex ~ "Gender", ageCat ~ "5-year age category", eduCat ~ "Education", 
     incomeCat ~ "Income", scoreCat ~ "Lifestyle composition score", 
     Smoker ~ "Have smoked at least 100 cigarettes lifetime", 
     PhysActivity ~ "Physical activity in past 30 days (not including job)", 
     Fruits ~ "Consume fruit >= 1 times per day", 
     Veggies ~ "Consume vegetables >= 1 times per day", 
     HvyAlcoholConsump ~ "Heavy drinkers", HighBP ~ "High blood pressure", 
     HighChol ~ "High cholesterol", Stroke ~ "Ever had a stroke", 
     HeartDiseaseorAttack ~ "Coronary heart disease or myocardial infarction", 
     AnyHealthcare ~ "Any health coverage"), 
     statistic = all_continuous() ~ "{mean}({sd})",
                   type = all_continuous() ~ 'continuous2',
                   missing = "no") %>% add_p()
```

```{r, echo=FALSE}
plot_income <- ggplot(data, 
                      aes(x=factor(incomeCat), fill = factor(diaCat))) + 
     geom_bar(position = "dodge", width = 0.8)+
     scale_fill_manual(values = c("Healthy" = "lightblue", 
                                  "Prediabetes or diabetes" = "darkorange"))+
     labs(x = "Income category", y = "Count", fill = "Diabetes status") +
     facet_wrap(~scoreCat, ncol =1) +
     theme_bw() +
     theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
     ggtitle("Income of participants in different lifestyle score category and diabetes status")
plot_income  

# plots on age categories
plot_age <- ggplot(data, 
                      aes(x=factor(ageCat), fill = factor(diaCat))) + 
     geom_bar(position = "dodge", width = 0.8)+
     scale_fill_manual(values = c("Healthy" = "lightblue", 
                                  "Prediabetes or diabetes" = "darkorange"))+
     labs(x = "Age category", y = "Count", fill = "Diabetes status") +
     facet_wrap(~scoreCat, ncol =1) +
     theme_bw() +
     theme(axis.text.x = element_text(angle = 45, hjust = 1))+
     ggtitle("Age of participants in different lifestyle score category and diabetes status")
plot_age

# plot on gender
plot_gender <- ggplot(data, 
                      aes(x=gender, fill = factor(diaCat))) + 
     geom_bar(position = "dodge", width = 0.8)+
     scale_fill_manual(values = c("Healthy" = "lightblue", 
                                  "Prediabetes or diabetes" = "darkorange"))+
     labs(x = "Gender", y = "Count", fill = "Diabetes status") +
     facet_wrap(~scoreCat, ncol =1) +
     theme_bw() +
     theme(axis.text.x = element_text(angle = 45, hjust = 1))+
     ggtitle("Gender of participants in different lifestyle score category and diabetes status")
plot_gender
```


## Methods
[Explain the statistical methods employed in the analysis, such as linear regression, Bayesian analysis, etc. Provide a brief rationale for their selection.]



### Build DAG with PC Algorithm and Literature Review

[blank]
As Ali (2013) pointed out, although individuals may have similar environmental exposures, certain people are more prone to developing diabetes compared to others, and this elevated susceptibility seems to be passed down through genetics. So, genetics is considered a precision variable because it is solely associated with diabetes and is not related to other variables.

### Logistic Regression with Adjustment
We consider the variable diabetes as the outcome variable, denoted as $Y$, and the variable score as the treatment variable, denoted as $X$. Our objective is to estimate the average causal effect of the score on diabetes, which can be expressed as $E[Y(X=1)] - E[Y(X=0)]$.

Before estimating the causal effect, it is essential to examine the association between diabetes and scores. In this case, diabetes takes the value 1 if a person has diabetes and 0 if a person does not have diabetes. Additionally, we assume a linear relationship between the log-odds of diabetes and scores. Hence, it is reasonable to employ a simple logistic model to capture their relationship.

We consider the following model: $\text{log}(\frac{p}{1-p}) = \beta_0 + \beta_1 X$, where $p$ represents the probability of an individual having diabetes, $\frac{p}{1-p}$ represents the odds, and $\text{log}(\frac{p}{1-p})$ represents the log-odds. In this model, $X$ corresponds to the score, and $\beta$ represents the corresponding coefficients.

Based on the Directed Acyclic Graph (DAG) shown in Graph 1, we observe three confounding paths. These paths indicate that confounding variables, namely age, gender, and income, simultaneously connect diabetes and scores. Consequently, estimating the effect of the score without accounting for these confounding variables would introduce bias. Therefore, it is necessary to determine whether controlling for these confounders would yield better estimates of the parameter of interest.

Using the adjustment criterion proposed by Shpitser et al. (2012), we conclude that adjusting for the three variables (denoted as $Z=\{Z_1, Z_2, Z_3\}$, where $Z_1$ represents age, $Z_2$ represents income, and $Z_3$ represents gender) is sufficient. This adjustment blocks all spurious paths from scores to diabetes and addresses confounding for the three variables. Moreover, it also blocks the confounding path for the variable education. Importantly, this adjustment does not block any of the causal paths from scores to diabetes and does not open any spurious paths. Consequently, we can utilize the non-parametric identification result from the observational distribution, which states that $E[Y(X=x)] = E[E[Y|X=x,Z]]$. Notably, when $Z$ satisfies the adjustment criterion, the conditional ignorability assumption holds, i.e., $Y_x \perp\!\!\!\perp X |Z$. This assumption aids in recovering the causal effect and improving the accuracy of the estimation, as highlighted by Cinelli et al. (2022).

Since we assume a linear relationship between the log-odds of diabetes and scores, age, income, and gender, which aligns with the aforementioned model, the logistic regression for confounding adjustment can be written as $\text{log}(\frac{p}{1-p}) = \beta_0 + \beta_1 X + \gamma_1 Z_1 + \gamma_2 Z_2 + \gamma_3 Z_3$, where $\gamma$ represents the corresponding coefficients. Consequently, the average causal effect corresponds to the regression coefficient $\beta_1$ (Cinelli et al., 2022).

```{r, echo=FALSE, results='hide', message=FALSE}
data$scoreCat <- ifelse(data$scoreCat == "> mean score",1,0)
diabetes <- data

model_score <- glm(Diabetes_binary ~ scoreCat, data = diabetes, 
                   family = binomial)
summary(model_score)

Confint(model_score, vcov. = vcovHC(model_score, type = "HC0")) 

model_score_adj <- glm(Diabetes_binary ~ scoreCat + Sex + Age + Income,
                       data = diabetes, family = binomial)
summary(model_score_adj)

Confint(model_score_adj, vcov. = vcovHC(model_score_adj, type = "HC0"))
```


```{r, echo=FALSE, message=FALSE, warning=FALSE}
results <- summary(model_score)$coefficients

rownames(results) <- c("score", "adjusted score")

results <- results[, c("Estimate", "Std. Error", "z value")]
colnames(results) <- c("Estimate", "2.5 %", "97.5 %")

results["score", ] <- c(-0.5980872, -0.620951, -0.5752233)
results["adjusted score", ] <- c(-0.3774651, -0.4016496, -0.3532806)

knitr::kable(results, digits = c(4, 4, 4), align = "c", caption = "Adjustment Results")
```


### Identity Heterogeneous Effects with R-learner

In this section, we investigate the heterogeneous effects of lifestyle factors on subgroups defined by age, sex, and income using the R-learner (Nie and Wager, 2017). This approach utilizes machine learning to estimate treatment effects in observational studies.

The R-learner is used to estimate the Conditional Average Treatment Effect (CATE), $\tau^*(z_1,z_2,z_3) = E(Y(1)-Y(0)|Z_1=z_1,Z_2 = z_2,Z_3 = z_3)$, with $Z_1$, $Z_2$, and $Z_3$ denoting individual features (age, income, and gender) and $Y_i$ the observed outcome.

Using the $\texttt{rlasso}$ method in $\texttt{rlearner}$, we input age, gender, and income as features, and a categorical score as the treatment variable, with diabetes presence indicating observed response. The algorithm of R-learner also includes cross-validation, we set it with ten folds. Finally, we visualize CATE CATE across income levels, gender, and age groups.

In the visualization of CATE across different income groups, we observe a correlation between higher income and a larger average treatment effect within the same income bracket. This trend is particularly pronounced among individuals earning over $50,000 annually, where the mean effect significantly surpasses that of other groups.

When comparing CATE across genders, it is noteworthy that the average treatment effect for females is lower than that for males.

The CATE across age groups shows a distinct decline as age increases. For individuals younger than 24, there is little discernible difference in the outcome between those maintaining good or poor lifestyles.

```{r, echo=FALSE, message=FALSE}
set.seed(1)
rW  = cbind(data$Age,data$Sex,data$Income)
rW = as.matrix(rW)
rA = data$scoreCat
rY = data$Diabetes_binary

rlasso_fit = rlasso(rW, rA, rY,k_folds = 10)
rlasso_est = predict(rlasso_fit, rW)

plotdata <- data.frame(Income = data$Income, 
                   Estimator =rlasso_est)
plotdata$Income_Group <- cut(plotdata$Income, breaks=c(0,2, 4,6, 8), labels=c("<15000","[15000,25000)","[25000,50000)", ">=50000"))
ggplot(plotdata, aes(x = Income_Group, y = Estimator, fill = Income_Group)) + 
  geom_boxplot() + 
  ggtitle("The result of R-learner(Income)") +
  xlab("Income Group") +
  ylab("Estimator") +
  scale_fill_brewer(palette="Set1") +
  theme_bw()

plotdata <- data.frame(Sex = data$Sex, 
                   Estimator =rlasso_est)
plotdata$Gender_Group <- ifelse(plotdata$Sex==0,"Female","Male")

ggplot(plotdata, aes(x = Gender_Group, y = Estimator, fill = Gender_Group)) + 
  geom_boxplot() + 
  ggtitle("The result of R-learner(Gender)") +
  xlab("Gender Group") +
  ylab("Estimator") +
  scale_fill_brewer(palette="Set2") +
  theme_bw()

plotdata <- data.frame(Age = data$Age, 
                   Estimator =rlasso_est)
plotdata$Age = as.factor(plotdata$Age)
age_labels <- c("18-24","25-29","30-34","35-39","40-44","45-49","51-54","55-59",
                "60-64","65-69","70-74","75-79",">=80")
ggplot(plotdata, aes(x = Age, y = Estimator, fill = Age)) + 
  geom_boxplot() + 
  ggtitle("The result of R-learner(Age)") +
  xlab("Age Group") +
  ylab("Estimator") +
  scale_fill_manual(values = rainbow(length(unique(plotdata$Age))), labels = age_labels) +
  theme_bw()
```


## Results

From the R-learner plots, we discern that higher income individuals are less likely to develop diabetes, even have poor lifestyle choices. This pattern is particularly noticeable for those earning over $50,000 annually. Regarding gender, the difference in diabetes risk between good and poor lifestyle habits is more pronounced in females than males, underscoring the importance of healthy habits for women. In terms of age, the substantial variation in CATE across different age groups suggests that maintaining a healthy lifestyle becomes increasingly vital as one ages. This is because poor lifestyle choices are more likely to induce diabetes as age increases.

## Discussion

### Target trial 

The key causal question we try to answer in this analysis is “whether lifestyle is a risk factor for developing prediabetes or diabetes in healthy participants”. Some basic criteria are expected to be satisfied in order to build causality between the exposure and outcome of interest, such as: (1) strength of association, (2) temporality, (3) consistency, (4) dose-response relationship, (5) biologically or theoretically plausible, (6) coherence, (7) specificity, and (8) consensus among experts and the scientific community.  The data of this analysis derives from the cross sectional questionnaire of BRFSS program in 2015, which has undermined the ability to build temporality between lifestyles and the development of prediabetes and diabetes. In an ideal situation to answer this causal question, a randomized controlled experiment should be conducted, where healthy participants are assigned to two groups of interventions and remain for a certain period of time, such as 3 years. One group of people are required to adopt healthy lifestyle including all the requirements mentioned below: “lifetime smoking less than 100 cigarettes”, “doing physical activity or exercising during the past 30 days other than their regular job”, “consume fruit 1 or more times per day”, “consume vegetables 1 or more times per day”, and “never drinking more than 14 drinks and 7 drinks per week for adult men and adult women, respectively”. Another group of people are required to adopt an unhealthy lifestyle, which is a reverse of the requirements in the healthy lifestyle group. All the participants are expected to adhere to their assigned interventions during the whole research period. However in reality, such a randomized trial is inapplicable not only due to ethical constraints, but also due to the limitations of precise definition of “healthy lifestyle” as well as the difficulties to let participants adhere strictly to the assigned lifestyles in everyday life. 

In our analysis, a weighted combination score was created by integrating participants' physical activity, smoking history, and alcohol, fruits, and vegetable consumption.  Then based on the combination score, participants were grouped as “having the score higher than the mean score of all the participants” or “less than or equal to the mean score of all the participants”. We take these categories as a proximation of the interventions that participants may receive in an RCT. However, people in the “higher than mean score” group does not necessarily mean they satisfy all the five requirements for a healthy lifestyle intervention in a RCT. We assume participants with higher than the mean score would in general adopt healthier lifestyles in our analysis. And thus, although we try to approach the true causal effect using this observational study, the effect between lifestyle factors and the risk of developing prediabetes or diabetes that we inferred from this observational study is different from the inference from an RCT. 

### Refined Management of Diabetes

Based on the estimated heterogeneity in treatment effects among subgroups (defined by factors age, income, and gender), it is clear that different groups respond differently to the treatment. Therefore, we can identify susceptible groups for prioritized preventive measures. 

From the perspective of income, it is crucial to pay particular attention to the low-income population. If their lifestyle is subpar and they lack the means to improve their current health status, the impact of their lifestyle becomes even more significant. Looking at it from an age standpoint, middle-aged and elderly individuals inherently have slower metabolic rates compared to younger people. If they continue to maintain unhealthy habits, they are more likely to develop illnesses. In terms of gender, poor lifestyle habits have a greater effect on women. Therefore, it is especially important for women, more so than men, to establish healthy lifestyle habits.

## Conclusion
- Healthier lifestyle is associated with lower risk of developing prediabetes or diabetes;
- Limitations exist in cross-sectional studies in inferring causal inference between independent variables and dependent variables;
- We can identify vulnerable groups for prioritized preventive measures based on the heterogeneous treatment effect. We need to pay particular attention to the low-income population, women, and middle-aged to elderly individuals.

## References

[Include a list of cited references using a suitable citation style (e.g., APA, MLA, IEEE).]

\newpage
## Appendix

### Summary of the dataset

```{r, echo=FALSE, message=FALSE}
tabl1
```

### DAG



### Definition (adjustment criterion (Shpitser et al., 2012)) 
A set of variables Z in the adjustment set satisfies the adjustment criterion relative to (X, Y) in a DAG G if:

- No element in Z is a descendant in $G_{\Bar{x}}$ (the DAG G without the edges with arrows coming into X) of any $W \notin X$ which lies on a proper causal path from X to Y.
- All non-causal paths in G from X to Y are blocked by Z.






